(()=>{"use strict";const r=class{constructor(r,e){this.length=r,this.life=r,this.character=e,this.orientation="horizontal",this.headCoord={},this.shipBodyCoords=[],this.adjacentCoords=[]}hit=()=>this.life--;isSunk=()=>0===this.life;setHeadCoord=r=>{this.headCoord=r,this.generateShipCoords(),this.generateAdjacentCoords()};setOrietation=r=>{this.orientation=r};changeOrientation=()=>"vertical"===this.orientation?this.orientation="horizontal":this.orientation="vertical";generateShipCoords=()=>{let r=[],e=0;if("horizontal"===this.orientation)for(;e<this.length;)r.push({x:Number(this.headCoord.x)+e,y:Number(this.headCoord.y)}),e++;else for(;e<this.length;)r.push({x:Number(this.headCoord.x),y:Number(this.headCoord.y)+e}),e++;return this.shipBodyCoords=r};generateAdjacentCoords(){let r=[];const e=this.shipBodyCoords[0],a=this.shipBodyCoords[this.shipBodyCoords.length-1],t=this.shipBodyCoords.slice(1,this.shipBodyCoords.length-1);"vertical"===this.orientation?(r.push({x:e.x-1,y:e.y},{x:e.x+1,y:e.y},{x:e.x,y:e.y-1},{x:e.x-1,y:e.y-1},{x:e.x+1,y:e.y-1}),t.forEach((e=>r.push({x:e.x+1,y:e.y},{x:e.x-1,y:e.y}))),r.push({x:a.x+1,y:a.y},{x:a.x,y:a.y+1},{x:a.x-1,y:a.y},{x:a.x-1,y:a.y+1},{x:a.x+1,y:a.y+1})):(r.push({x:e.x-1,y:e.y},{x:e.x,y:e.y-1},{x:e.x,y:e.y+1},{x:e.x-1,y:e.y-1},{x:e.x-1,y:e.y+1}),t.forEach((e=>r.push({x:e.x,y:e.y-1},{x:e.x,y:e.y+1}))),r.push({x:a.x+1,y:a.y},{x:a.x,y:a.y-1},{x:a.x,y:a.y+1},{x:a.x+1,y:a.y-1},{x:a.x+1,y:a.y+1}));const o=r.filter((r=>r.x<=9&&r.y<=9&&r.x>=0&&r.y>=0));return this.adjacentCoords=o}randomOrientation(){const r=Math.round(Math.random());return this.orientation=r<1?"horizontal":"vertical"}},e=class{constructor(e){this.name=e,this.gameBoard=new class{constructor(){this.gameboardArr=[["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""]],this.shipsArr=[new r(5,"A"),new r(4,"B"),new r(3,"C"),new r(3,"D"),new r(2,"E")]}receiveAttack=r=>{"M"!==this.gameboardArr[r.y][r.x]&&"X"!==this.gameboardArr[r.y][r.x]&&(""===this.gameboardArr[r.y][r.x]||"O"===this.gameboardArr[r.y][r.x]?this.gameboardArr[r.y][r.x]="M":this.successfulHit(r))};sunken(r){r.adjacentCoords.forEach((r=>this.gameboardArr[r.y][r.x]="M"))}successfulHit(r){const e=this.gameboardArr[r.y][r.x],a=this.shipsArr.find((r=>r.character===e));this.gameboardArr[r.y][r.x]="X",a.hit(),a.isSunk()&&this.sunken(a)}targetedShip=r=>{const e=this.gameboardArr[r.y][r.x];return this.shipsArr.find((r=>r.character===e))};notTargetedShips=r=>{const e=this.gameboardArr[r.y][r.x];return this.shipsArr.filter((r=>r.character!==e))};allShipSunkCheck=()=>this.shipsArr.every((r=>r.isSunk()));randomCoords(r,e){let a=o(),t=o();function o(){return Math.floor(10*Math.random())}return"horizontal"===e&&a+r<=9||"vertical"===e&&t+r<=9?{x:a,y:t}:this.randomCoords(r,e)}placeShipsRandomly=r=>{r.randomOrientation();const e=r.length,a=r.orientation;if(r.setHeadCoord(this.randomCoords(e,a)),!this.canBePlace(r))return this.placeShipsRandomly(r);this.insertCharactersToGBArr(r)};insertCharactersToGBArr=r=>{r.shipBodyCoords.forEach((e=>this.gameboardArr[e.y][e.x]=r.character)),r.adjacentCoords.forEach((r=>{this.gameboardArr[r.y][r.x]="O"}))};canBePlace=r=>!r.shipBodyCoords.some((r=>r.x>9||r.y>9))&&r.shipBodyCoords.every((r=>""===this.gameboardArr[r.y][r.x]));placeShips=()=>{this.gameboardArr.every((r=>r.every((r=>""===r))))&&this.shipsArr.forEach((r=>this.placeShipsRandomly(r)))}}}placeShipsRandomly(){this.gameBoard.placeShips()}attack(r){const e=this.createRandomCoord();"M"!==r.gameBoard.gameboardArr[e.y][e.x]||"X"!==r.gameBoard.gameboardArr[e.y][e.x]?r.gameBoard.receiveAttack(e):this.attack(r)}createRandomCoord(){function r(){return Math.floor(10*Math.random())}return{x:r(),y:r()}}},a=r=>{const e=r.gameboardArr;let a=[];return e.forEach(((r,e)=>{r.forEach(((r,t)=>{if(""!==r&&"O"!==r){let r=document.querySelector(`.player > [data-x="${t}"][data-y="${e}"]`);a.push(r)}}))})),a},t=r=>{a(r).forEach((r=>r.classList.add("occupied")))},o=(r,e)=>{r.shipBodyCoords.forEach((r=>{document.querySelector(`.player > [data-x="${r.x}"][data-y="${r.y}"]`).classList.add("eligible")})),t(e)},s=r=>{[...document.querySelectorAll(".player > div")].forEach((r=>{r.classList.contains("eligible")&&r.classList.remove("eligible")})),t(r)},d=(r,e,a,o)=>{const d=document.querySelector(`.player > [data-x="${a.headCoord.x}"][data-y="${a.headCoord.y}"]`);return{add:()=>{d.addEventListener("click",(()=>((r,e,a,o)=>{e||a.setHeadCoord(r),[...document.querySelectorAll(".player > div")].forEach((r=>r.replaceWith(r.cloneNode(!0)))),o.insertCharactersToGBArr(a),(r=>{[...document.querySelectorAll(".player > div")].forEach((r=>{r.classList.contains("changing")&&(r.classList.contains("head")&&(r.classList.remove("head"),r.classList.remove("changing")),r.classList.remove("changing"))})),t(r)})(o),s(o),h.add(o)})(r,e,a,o)))}}},i=(r,e,a)=>{const t=[...document.querySelectorAll(".player > div")];return{add:()=>{t.forEach((t=>t.addEventListener("mouseover",(t=>((r,e,a,t)=>{const s={x:r.target.dataset.x,y:r.target.dataset.y};a.setHeadCoord(s),((r,e,a)=>{a.canBePlace(e)?(o(e,a),d(r,!0,e,a).add()):d(r,!1,e,a).add()})(e,a,t)})(t,r,e,a))))),t.forEach((r=>r.addEventListener("mouseout",(()=>((r,e)=>{s(e)})(0,a)))))}}},h={add:r=>{a(r).forEach((e=>e.addEventListener("click",(e=>((r,e)=>{const h={x:r.target.dataset.x,y:r.target.dataset.y},n=e.targetedShip(h),c=e.notTargetedShips(h),y=n.headCoord;a(e).forEach((r=>r.replaceWith(r.cloneNode(!0)))),((r,e)=>{r.shipBodyCoords.forEach((r=>e.gameboardArr[r.y][r.x]="")),r.adjacentCoords.forEach((r=>e.gameboardArr[r.y][r.x]=""))})(n,e),((r,e)=>{r.forEach((r=>e.insertCharactersToGBArr(r)))})(c,e),((r,e)=>{r.shipBodyCoords.forEach((r=>{let e=document.querySelector(`.player > [data-x="${r.x}"][data-y="${r.y}"]`);e.classList.remove("occupied"),e.classList.add("changing")})),document.querySelector(`.player > [data-x="${r.headCoord.x}"][data-y="${r.headCoord.y}"]`).classList.add("head"),t(e)})(n,e),((r,e,a)=>{const t=document.querySelector(`.player > [data-x="${e.headCoord.x}"][data-y="${e.headCoord.y}"]`);let i=e.orientation;return{add:()=>{t.addEventListener("mouseover",(()=>((r,e,a)=>{e.changeOrientation(),e.setHeadCoord(r),a.canBePlace(e)?(o(e,a),d(r,!0,e,a).add()):(e.changeOrientation(),e.setHeadCoord(r),d(r,!0,e,a).add())})(r,e,a))),t.addEventListener("mouseout",(()=>((r,e,a,t)=>{a.orientation!==e&&a.changeOrientation(),s(t)})(0,i,e,a)))}}})(y,n,e).add(),i(y,n,e).add()})(e,r)))))}};!function(){const r=new e("player");r.placeShipsRandomly(),t(r.gameBoard),h.add(r.gameBoard);new e("computer").placeShipsRandomly()}()})();