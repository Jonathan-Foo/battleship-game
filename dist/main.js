(()=>{"use strict";const e=class{constructor(e,t){this.length=e,this.life=e,this.character=t,this.orientation="horizontal",this.headCoord={},this.shipBodyCoords=[],this.adjacentCoords=[]}hit=()=>this.life--;isSunk=()=>0===this.life;setHeadCoord=e=>{this.headCoord=e,this.generateShipCoords(),this.generateAdjacentCoords()};setOrietation=e=>{this.orientation=e};changeOrientation=()=>"vertical"===this.orientation?this.orientation="horizontal":this.orientation="vertical";generateShipCoords=()=>{let e=[],t=0;if("horizontal"===this.orientation)for(;t<this.length;)e.push({x:Number(this.headCoord.x)+t,y:Number(this.headCoord.y)}),t++;else for(;t<this.length;)e.push({x:Number(this.headCoord.x),y:Number(this.headCoord.y)+t}),t++;return this.shipBodyCoords=e};generateAdjacentCoords(){let e=[];const t=this.shipBodyCoords[0],a=this.shipBodyCoords[this.shipBodyCoords.length-1],r=this.shipBodyCoords.slice(1,this.shipBodyCoords.length-1);"vertical"===this.orientation?(e.push({x:t.x-1,y:t.y},{x:t.x+1,y:t.y},{x:t.x,y:t.y-1},{x:t.x-1,y:t.y-1},{x:t.x+1,y:t.y-1}),r.forEach((t=>e.push({x:t.x+1,y:t.y},{x:t.x-1,y:t.y}))),e.push({x:a.x+1,y:a.y},{x:a.x,y:a.y+1},{x:a.x-1,y:a.y},{x:a.x-1,y:a.y+1},{x:a.x+1,y:a.y+1})):(e.push({x:t.x-1,y:t.y},{x:t.x,y:t.y-1},{x:t.x,y:t.y+1},{x:t.x-1,y:t.y-1},{x:t.x-1,y:t.y+1}),r.forEach((t=>e.push({x:t.x,y:t.y-1},{x:t.x,y:t.y+1}))),e.push({x:a.x+1,y:a.y},{x:a.x,y:a.y-1},{x:a.x,y:a.y+1},{x:a.x+1,y:a.y-1},{x:a.x+1,y:a.y+1}));const o=e.filter((e=>e.x<=9&&e.y<=9&&e.x>=0&&e.y>=0));return this.adjacentCoords=o}randomOrientation(){const e=Math.round(Math.random());return this.orientation=e<1?"horizontal":"vertical"}},t=class{constructor(t){this.name=t,this.gameBoard=new class{constructor(){this.gameboardArr=[["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""]],this.shipsArr=[new e(2,"E"),new e(3,"D"),new e(3,"C"),new e(4,"B"),new e(5,"A")]}receiveAttack=e=>{"M"!==this.gameboardArr[e.y][e.x]&&"X"!==this.gameboardArr[e.y][e.x]&&(""===this.gameboardArr[e.y][e.x]||"O"===this.gameboardArr[e.y][e.x]?this.gameboardArr[e.y][e.x]="M":this.successfulHit(e))};sunken(e){e.adjacentCoords.forEach((e=>this.gameboardArr[e.y][e.x]="M"))}successfulHit(e){const t=this.gameboardArr[e.y][e.x],a=this.shipsArr.find((e=>e.character===t));this.gameboardArr[e.y][e.x]="X",a.hit(),a.isSunk()&&this.sunken(a)}targetedShip=e=>{const t=this.gameboardArr[e.y][e.x];return this.shipsArr.find((e=>e.character===t))};notTargetedShips=e=>{const t=this.gameboardArr[e.y][e.x];return this.shipsArr.filter((e=>e.character!==t))};allShipSunkCheck=()=>this.shipsArr.every((e=>e.isSunk()));randomCoords(e,t){let a=o(),r=o();function o(){return Math.floor(10*Math.random())}return"horizontal"===t&&a+e<=9||"vertical"===t&&r+e<=9?{x:a,y:r}:this.randomCoords(e,t)}placeShipsRandomly=e=>{e.randomOrientation();const t=e.length,a=e.orientation;if(e.setHeadCoord(this.randomCoords(t,a)),!this.canBePlace(e))return this.placeShipsRandomly(e);this.insertCharactersToGBArr(e)};insertCharactersToGBArr=e=>{e.shipBodyCoords.forEach((t=>this.gameboardArr[t.y][t.x]=e.character)),e.adjacentCoords.forEach((e=>{this.gameboardArr[e.y][e.x]="O"}))};canBePlace=e=>!e.shipBodyCoords.some((e=>e.x>9||e.y>9))&&e.shipBodyCoords.every((e=>""===this.gameboardArr[e.y][e.x]));placeShips=()=>{this.gameboardArr.every((e=>e.every((e=>""===e))))&&this.shipsArr.forEach((e=>this.placeShipsRandomly(e)))}}}placeShipsRandomly(){this.gameBoard.placeShips()}randomAttack(e){const t=this.createRandomCoord();"M"!==e.gameBoard.gameboardArr[t.y][t.x]||"X"!==e.gameBoard.gameboardArr[t.y][t.x]?e.gameBoard.receiveAttack(t):this.attack(e)}targettedAttack(e,t){const a=e;t.gameBoard.receiveAttack(a)}createRandomCoord(){function e(){return Math.floor(10*Math.random())}return{x:e(),y:e()}}},a=e=>{const t=e.gameboardArr;let a=[];return t.forEach(((e,t)=>{e.forEach(((e,r)=>{if(""!==e&&"O"!==e){let e=document.querySelector(`.player > [data-x="${r}"][data-y="${t}"]`);a.push(e)}}))})),a},r=e=>{a(e).forEach((e=>e.classList.add("occupied")))},o=(e,t)=>{e.shipBodyCoords.forEach((e=>{document.querySelector(`.player > [data-x="${e.x}"][data-y="${e.y}"]`).classList.add("eligible")})),r(t)},s=e=>{[...document.querySelectorAll(".player > div")].forEach((e=>{e.classList.contains("eligible")&&e.classList.remove("eligible")})),r(e)},d=(e,t,a,o)=>{const d=document.querySelector(`.player > [data-x="${a.headCoord.x}"][data-y="${a.headCoord.y}"]`);return{add:()=>{d.addEventListener("click",(()=>((e,t,a,o)=>{t||a.setHeadCoord(e),[...document.querySelectorAll(".player > div")].forEach((e=>e.replaceWith(e.cloneNode(!0)))),o.insertCharactersToGBArr(a),(e=>{[...document.querySelectorAll(".player > div")].forEach((e=>{e.classList.contains("changing")&&(e.classList.contains("head")&&(e.classList.remove("head"),e.classList.remove("changing")),e.classList.remove("changing"))})),r(e)})(o),s(o),c.add(o)})(e,t,a,o)))}}},i=(e,t,a)=>{const r=[...document.querySelectorAll(".player > div")];return{add:()=>{r.forEach((r=>r.addEventListener("mouseover",(r=>((e,t,a,r)=>{const s={x:e.target.dataset.x,y:e.target.dataset.y};a.setHeadCoord(s),((e,t,a)=>{a.canBePlace(t)?(o(t,a),d(e,!0,t,a).add()):d(e,!1,t,a).add()})(t,a,r)})(r,e,t,a))))),r.forEach((e=>e.addEventListener("mouseout",(()=>((e,t)=>{s(t)})(0,a)))))}}},c={add:e=>{a(e).forEach((t=>t.addEventListener("click",(t=>((e,t)=>{const c={x:e.target.dataset.x,y:e.target.dataset.y},n=t.targetedShip(c),h=t.notTargetedShips(c),l=n.headCoord;a(t).forEach((e=>e.replaceWith(e.cloneNode(!0)))),((e,t)=>{e.shipBodyCoords.forEach((e=>t.gameboardArr[e.y][e.x]="")),e.adjacentCoords.forEach((e=>t.gameboardArr[e.y][e.x]=""))})(n,t),((e,t)=>{e.forEach((e=>t.insertCharactersToGBArr(e)))})(h,t),((e,t)=>{e.shipBodyCoords.forEach((e=>{let t=document.querySelector(`.player > [data-x="${e.x}"][data-y="${e.y}"]`);t.classList.remove("occupied"),t.classList.add("changing")})),document.querySelector(`.player > [data-x="${e.headCoord.x}"][data-y="${e.headCoord.y}"]`).classList.add("head"),r(t)})(n,t),((e,t,a)=>{const r=document.querySelector(`.player > [data-x="${t.headCoord.x}"][data-y="${t.headCoord.y}"]`);let i=t.orientation;return{add:()=>{r.addEventListener("mouseover",(()=>((e,t,a)=>{t.changeOrientation(),t.setHeadCoord(e),a.canBePlace(t)?(o(t,a),d(e,!0,t,a).add()):(t.changeOrientation(),t.setHeadCoord(e),d(e,!0,t,a).add())})(e,t,a))),r.addEventListener("mouseout",(()=>((e,t,a,r)=>{a.orientation!==t&&a.changeOrientation(),s(r)})(0,i,t,a)))}}})(l,n,t).add(),i(l,n,t).add()})(t,e)))))}},n=(e,t)=>{const a=e.name,r=e.gameBoard.gameboardArr,o=t.name,s=e.gameBoard.shipsArr;r.forEach(((e,t)=>{e.forEach(((e,r)=>{"computer"===a?((e,t,a)=>{switch(e){case"M":document.querySelector(`.computer > [data-x="${t}"][data-y="${a}"]`).classList.add("miss");break;case"X":document.querySelector(`.computer > [data-x="${t}"][data-y="${a}"]`).classList.add("hit")}})(e,r,t):((e,t,a)=>{switch(e){case"":case"O":break;case"M":document.querySelector(`.player > [data-x="${t}"][data-y="${a}"]`).classList.add("miss");break;case"X":let e=document.querySelector(`.player > [data-x="${t}"][data-y="${a}"]`);e.classList.remove("occupied"),e.classList.add("hit");break;default:document.querySelector(`.player > [data-x="${t}"][data-y="${a}"]`).classList.add("occupied")}})(e,r,t)}))})),(()=>{const e=a.charAt(0).toUpperCase()+a.slice(1);document.querySelector(".instruction > p").textContent=`${e}'s Turn`})(),document.getElementById(`${a}-table`).classList.add("disabled"),(()=>{const e=document.getElementById(`${o}-table`);e.classList.contains("disabled")&&e.classList.remove("disabled")})(),s.forEach(((e,t)=>{e.isSunk()&&((e,t)=>{[...document.querySelectorAll(`.ship-wrapper.${t}`)][e].classList.add("sunk")})(t,a)}))},h=e=>{const t=e.name,a=t.charAt(0).toUpperCase()+t.slice(1);document.querySelector(".instruction > p").textContent=`${a} Won!`,document.getElementById("start-btn").addEventListener("click",(()=>window.location.reload())),[...document.querySelectorAll(".computer > div")].forEach((e=>e.replaceWith(e.cloneNode(!0))))},l=(e,t)=>{var r;n(e,t),(()=>{const e=document.getElementById("start-btn");e.replaceWith(e.cloneNode(!0))})(),r=e.gameBoard,a(r).forEach((e=>e.replaceWith(e.cloneNode(!0)))),((e,t)=>{[...document.querySelectorAll(".computer > div")].forEach((a=>a.addEventListener("click",(a=>((e,t,a)=>{const r=e.target.dataset.x,o=e.target.dataset.y,s={x:r,y:o};"M"!==a.gameBoard.gameboardArr[o][r]&&"X"!==a.gameBoard.gameboardArr[o][r]&&(t.targettedAttack(s,a),((e,t)=>{if(t.gameBoard.allShipSunkCheck())return n(t,e),h(e);n(t,e),setTimeout((()=>{if(t.randomAttack(e),n(t,e),e.gameBoard.allShipSunkCheck())return n(e,t),h(t);n(e,t)}),1500)})(t,a))})(a,e,t)))))})(e,t)};!function(){const e=new t("player");e.placeShipsRandomly(),r(e.gameBoard),c.add(e.gameBoard);const a=new t("computer");var o,s;a.placeShipsRandomly(),o=e,s=a,document.getElementById("start-btn").addEventListener("click",(()=>l(o,s)))}()})();